@model CallCenterSecure.Models.AllianceOutbound

@{
    ViewBag.Title = "Edit";
}
@*<link href="~/Content/bootstrap-datepicker.min.css" rel="stylesheet" />
    <link href="~/Content/all.min.css" rel="stylesheet" />*@
<link href="~/Content/jquery-ui.css" rel="stylesheet" />
<style>
    .save-btn {
        background-color: #005cc8; /* Blue color */
        color: #fff !important;
        padding: 10px 28px;
        border: none;
        border-radius: 12px; /* Rounded corners */
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        transition: 0.2s;
    }

        .save-btn:hover {
            background-color: #004a9e; /* Slightly darker blue */
        }
</style>
<h2>Edit</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>AllianceOutbound</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.AllianceOutboundId)

        <div class="col-md-6">
            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.TicketID, htmlAttributes: new { @class = "col-md-4 col-form-label" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.TicketID, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.TicketID, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.CustomerCode, htmlAttributes: new { @class = "col-md-4 col-form-label" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.CustomerCode, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CustomerCode, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.CustomerNameEnglish, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.CustomerNameEnglish, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CustomerNameEnglish, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Branch, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.Branch, (SelectList)ViewBag.Branches, "Select Branch", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Branch, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.StateRegion, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.StateRegion, (SelectList)ViewBag.Regions, "Select State/Region", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.StateRegion, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.District, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.District, (SelectList)ViewBag.Districts, "Select District", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.District, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.CityTownship, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.CityTownship, (SelectList)ViewBag.Cities, "Select City/Township", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.CityTownship, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.VillageTractTown, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.VillageTractTown, (SelectList)ViewBag.VillageTracts, "Select Village Tract/Town", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.VillageTractTown, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.VillageWard, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.VillageWard, (SelectList)ViewBag.Villages, "Select Village/Ward", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.VillageWard, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Address, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Address, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Address, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.PrimaryMobileNumber, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.PrimaryMobileNumber, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.PrimaryMobileNumber, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.AlternateMobileNumber, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.AlternateMobileNumber, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.AlternateMobileNumber, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.ProductInterested, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.ProductInterested, (SelectList)ViewBag.Products, "Select Product Interested", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.ProductInterested, "", new { @class = "text-danger" })
                </div>
            </div>
        </div>
        <div class="col-md-6">

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Latitude, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Latitude, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Latitude, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Longitude, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Longitude, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Longitude, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.NRC, htmlAttributes: new { @class = "control-label col-md-4" })

                <div class="col-md-8">
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <label>State Division</label>
                            @Html.DropDownList(
                                "StateDivisionDropdown",
                                (SelectList)ViewBag.StateDivisionList,
                                "Select Division",
                                new { @class = "form-control" }
                            )
                        </div>
                        <div class="col-md-4">
                            <label>Township</label>
                            <select id="TownshipDropdown" class="form-control">
                                <option value="">Select Township</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label>Citizen</label>
                            @Html.DropDownList(
                                "CitizenDropdown",
                                (SelectList)ViewBag.CitizenList,
                                "Select Citizen",
                                new { @class = "form-control" }
                            )
                        </div>
                        <div class="col-md-4">
                            <label>Ref. Number</label>
                            <input id="NRCRefNumber" type="text" />
                        </div>
                    </div>

                    @Html.EditorFor(model => model.NRC, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.NRC, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.DateOfBirth, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.TextBoxFor(model => model.DateOfBirth, "{0:yyyy/MM/dd}", new { @class = "form-control datepicker" })
                    @Html.ValidationMessageFor(model => model.DateOfBirth, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Age, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Age, new { htmlAttributes = new { @class = "form-control", disabled = "disabled" } })
                    @Html.ValidationMessageFor(model => model.Age, "", new { @class = "text-danger" })
                    @Html.HiddenFor(model => model.Age)
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Gender, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.Gender, new SelectList(new List<SelectListItem>
                            {
                                new SelectListItem { Value = "Male", Text = "Male" },
                                new SelectListItem { Value = "Female", Text = "Female" }
                            }, "Value", "Text"), "Select Gender", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Gender, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.MaritalStatus, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.MaritalStatus, new SelectList(new List<SelectListItem>
                             {
                                 new SelectListItem { Value = "Married", Text = "Married" },
                                 new SelectListItem { Value = "Unmarried", Text = "Unmarried" }
                             }, "Value", "Text"), "Select Marital Status", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.MaritalStatus, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.SpouseName, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.SpouseName, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.SpouseName, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Priority, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.Priority, new SelectList(new List<SelectListItem>
                             {
                                 new SelectListItem { Value = "Blank", Text = "Blank" },
                                 new SelectListItem { Value = "Hot", Text = "Hot" },
                                 new SelectListItem { Value = "Warm", Text = "Warm" },
                                 new SelectListItem { Value = "Cold", Text = "Cold" }
                             }, "Value", "Text"), "Select Priority", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Priority, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.ClientOfficerName, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.ClientOfficerName, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.ClientOfficerName, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.CallStatus, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.CallStatus, new SelectList(new List<SelectListItem>
                             {
                                 new SelectListItem { Value = "Inactive", Text = "Inactive" },
                                 new SelectListItem { Value = "Active", Text = "Active" }

                             }, "Value", "Text"), "Select CallStatus", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.CallStatus, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.CallType, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.CallType, new SelectList(new List<SelectListItem>
                             {
                                 new SelectListItem { Value = "Follow Up Call", Text = "Follow Up Call" },
                                 new SelectListItem { Value = "Survey Call", Text = "Survey Call" },
                                 new SelectListItem { Value = "Re-dial Missed Call", Text = "Re-dial Missed Call" }
                             }, "Value", "Text"), "Select CallType", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.CallType, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group row mb-2">
                @Html.LabelFor(model => model.Prev_TicketId, htmlAttributes: new { @class = "col-md-4 col-form-label" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Prev_TicketId, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Prev_TicketId, "", new { @class = "text-danger" })
                </div>
            </div>
        </div>

        @*<div class="form-group">
                @Html.LabelFor(model => model.AgentName, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.AgentName, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.AgentName, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.AgentId, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.AgentId, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.AgentId, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.CallStartDateTime, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.CallStartDateTime, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CallStartDateTime, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.CallEndDateTime, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.CallEndDateTime, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CallEndDateTime, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.Duration, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.Duration, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Duration, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.CreatedOn, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.CreatedOn, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CreatedOn, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.ModifiedOn, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.ModifiedOn, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.ModifiedOn, "", new { @class = "text-danger" })
                </div>
            </div>*@

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Save" class="btn save-btn" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryui")
    <script type="text/javascript">
        $(document).ready(function () {

            $('#DateOfBirth').on('changeDate change', function () {

                var dob = $('#DateOfBirth').datepicker('getDate');
                calculateAge(dob);
            });

            $("#CitizenDropdown").change(updateNRC);
            $("#StateDivisionDropdown").change(updateNRC);
            $("#TownshipDropdown").change(updateNRC);
            $("#NRCRefNumber").on("blur keyup", updateNRC);

             $("#StateDivisionDropdown").change(function() {
         var stateDivisionCode = $(this).val();

         var townshipDropdown = $("#TownshipDropdown");

         // Clear Township dropdown first
         townshipDropdown.empty();
         townshipDropdown.append('<option value="">Select Township</option>');


        if(stateDivisionCode) {
            $.ajax({
                url: '@Url.Action("GetTownshipsByStateDivision")',
                type: 'GET',
                data: { stateDivisionCode: stateDivisionCode },
                success: function(data) {
                    var townshipDropdown = $("#TownshipDropdown");
                    townshipDropdown.empty();
                    townshipDropdown.append('<option value="">Select Township</option>');
                    $.each(data, function(index, item) {
                        townshipDropdown.append('<option value="' + item.Value + '">' + item.Text + '</option>');
                    });
                }
            });
        } else {
            $("#TownshipDropdown").empty().append('<option value="">Select Township</option>');
        }
    });


             $("#StateRegion").change(function () {
                 var stateId = $(this).val();
                 console.log(stateId);
            $.getJSON('@Url.Action("GetDistricts", "AllianceOutbound")/' + stateId, function (data) {
                var districtSelect = $("#District");
                districtSelect.empty();
                districtSelect.append($('<option/>', {
                    value: '',
                    text: 'Select District'
                }));
                $.each(data, function (index, district) {
                    districtSelect.append($('<option/>', {
                        value: district.DistrictId,
                        text: district.DistrictName
                    }));
                });
            });
        });

            //$('#DateOfBirth').datepicker({
            //    format: 'yyyy/mm/dd',
            //    setDate: new Date(),
            //    endDate: '+0d',
            //    autoclose: true
            //});

    });
        function updateNRC() {

            var selectedText = $("#StateDivisionDropdown option:selected").text();
            var divisionCode = selectedText.split('-')[0].trim();

            var townshipCode = $("#TownshipDropdown").val();        // MaKaNa
            var citizenCode = $("#CitizenDropdown").val();          // N
            var refNumber = $("#NRCRefNumber").val();               // 123456

            if (!divisionCode || !townshipCode || !citizenCode || !refNumber) {
                $("#NRC").val("");
                return;
            }

            var nrc = divisionCode + "/" +
                townshipCode + "(" +
                citizenCode + ")" +
                refNumber;

            $("#NRC").val(nrc);


        }

        function calculateAge(dob) {
            if (!dob) {
                $('#Age').val('');
                $('input[name="Age"]').val('');
                return;
            }

            var today = new Date();
            var age = today.getFullYear() - dob.getFullYear();
            var m = today.getMonth() - dob.getMonth();

            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                age--;
            }

            $('#Age').val(age);
            $('input[name="Age"]').val(age);

            $('input[name="Age"]').val(age); // hidden field
        }

        $(function () {
            $(".datepicker").datepicker({
                dateFormat: "yy-mm-dd",
                changeMonth: true,
                changeYear: true,
                yearRange: "-120:+0",   // from 120 years ago to current year
                maxDate: 0,             // prevent future dates
                autoclose: true         // harmless (ignored by jQuery UI)
            });
        });
    </script>
}